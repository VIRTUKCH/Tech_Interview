# Docker

## Docker 란?
Docker는 컨테이너를 기반으로 가상화 기술을 제공하는 플랫폼이다. 애플리케이션과 해당 환경을 패키징하여 실행할 수 있도록 해 주며, 어디서든 일관된 환경에서 실행할 수 있도록 보장한다.

* 플랫폼이란, 소프트웨어나 서비스를 실행할 수 있는 기반을 의미한다. 예를 들면, 스마트폰, JVM, AWS, Docker 등이 있다.

## 전통적인 Virtualization(가상화)
전통적인 가상화(VM, Virtual Machine)는 하드웨어 레벨에서 가상화하여 각 VM이 자체 운영체제(OS)를 포함하도록 만든다.

하이퍼바이저(Hypervisor) 라는 가상화 소프트웨어를 사용해서 하나의 물리적 서버 (Host Machine) 위에서 여러 개의 가상 머신(Guest OS) 을 실행할 수 있다.

이러한 방식에서는 하나의 물리적 서버(Host Machine) 위에서 별도의 운영체제(Guest OS)를 설치하고, 해당 OS 에 CPU, 메모리, 디스크와 같은 하드웨어 자원을 가상화하여 독립적인 하나의 컴퓨터처럼 사용할 수 있게 한다.

파일 구조, 네트워크 및 통신 기능과 같은 면에서 완전히 하나의 PC 로서의 역할을 할 수 있다는 것이 특징이며, 그런 점에서 보안 연구 및 침투 테스트(펜테스팅) 역할을 하기에 좋고, 실제로 해킹과 관련된 수업에서는 VM 을 사용하여 모의 공격을 해보기도 한다.

## 전통적인 Virtualization(가상화) 와 Docker 의 차이점
Docker는 컨테이너 기술을 이용해 Host OS의 커널을 공유하며, 애플리케이션과 그 실행 환경(라이브러리, 파일 시스템, 네트워크, 프로세스)을 격리하는 방식으로 작동된다.

Docker는 호스트 운영체제의 커널을 공유하며, 애플리케이션 실행에 필요한 라이브러리 및 실행 환경만을 포함하여 독립적인 환경에서 실행된다. 여기서 말하는 독립적인 환경은 OS 레벨에서 격리된 환경을 의미하는 것이지, VM 처럼 완전히 독립적인 OS 는 아니다.

이러한 방식 덕분에 리소스 사용량이 적고, 가볍고 빠른 배포가 가능하다. 전통적인 VM 은 VM 마다 OS 가 있어 무겁고 리소스 사용량이 많으며, OS 부팅이 수 분 단위로 필요하기도 하다.

## 커널이란?
커널(Kernel)은 운영체제(OS)의 핵심(Core) 부분으로, 하드웨어와 소프트웨어 간의 인터페이스 역할을 수행하는 가장 중요한 컴퓨터 시스템 구성 요소다.

모든 운영체제(Windows, Linux, macOS 등)는 커널을 기반으로 동작하며, 커널은 프로세스, 메모리, 파일 시스템, 네트워크, 장치 드라이버 등 시스템의 핵심 리소스를 관리하는 역할을 한다.

예를 들면, CPU 스케줄링과 같은 프로세스 관리, RAM 의 할당 및 해제 & 가상 메모리와 같은 메모리 관리, 파일 시스템 관리, 네트워크 관리 등, 디바이스 드라이버 및 하드웨어 관리 등이다.

* 디바이스 드라이버 및 하드웨어 관리란, CPU, RAM, 디스크, 네트워크 인터페이스 등 하드웨어 장치와 소프트웨어가 상호작용할 수 있도록 지원하는 것을 말한다. 운영체제와 하드웨어 간의 저수준(Level) 인터페이스 역할을 수핸한다.

* 그러한 맥락에서, 컨테이너는 하드웨어 리소스를 직접 접근할 수 없으며, 커널을 통해 간접적으로 하드웨어에 접근한다.

## Doccker 와 커널의 관계
Docker는 전통적인 가상 머신(VM)과는 다르게 Host OS의 커널을 공유하는 방식으로 동작한다.
이러한 차이로 인해 VM보다 가볍고 빠른 실행이 가능하지만, 커널 공유로 인해 몇 가지 특징이 생긴다.

### 🔹 1) Docker 컨테이너는 별도의 커널을 포함하지 않는다.
- 전통적인 VM은 각각 독립적인 OS와 커널을 포함하지만, Docker 컨테이너는 Host OS의 커널을 공유하여 동작함.
- 즉, 컨테이너는 커널 없이 실행되지 않으며, 반드시 커널이 존재하는 환경에서 실행되어야 한다.

### 🔹 2) Docker 컨테이너는 리눅스 기반에서 실행됨.
- Docker는 기본적으로 리눅스 컨테이너를 실행하므로, Linux 커널의 기능을 활용하여 격리된 환경을 제공한다.
- Windows에서 리눅스 컨테이너를 실행하려면, Hyper-V 또는 WSL2를 통해 리눅스 커널을 가상으로 실행해야 한다.

### 🔹 3) 네임스페이스(Namespaces)와 cgroups를 활용한 격리
- 네임스페이스(Namespaces): 프로세스, 네트워크, 파일 시스템 등을 격리하여 각 컨테이너가 독립적으로 동작하도록 만듦.
- cgroups(Control Groups): CPU, 메모리 등의 리소스를 컨테이너 단위로 제한하여 자원 관리를 수행.
- 즉, Docker 컨테이너는 독립적인 OS가 아니라, 커널의 격리 기능을 활용하여 마치 별도의 운영체제처럼 동작하는 것이다.

## Docker가 동작하려면 반드시 커널이 필요하다.
Docker 컨테이너는 단독으로 실행될 수 없으며, 반드시 커널이 존재하는 환경에서 실행되어야 한다.

- Linux에서 Docker 실행 → 리눅스 커널을 그대로 사용하여 실행됨.
- Windows에서 Docker 실행
- - Windows 컨테이너 실행 → Windows 커널 사용
- - Linux 컨테이너 실행 → Hyper-V 기반 Linux VM or WSL2를 통해 리눅스 커널을 실행한 후 컨테이너를 실행

## 결론: Docker와 커널의 관계 정리
- ✔ 커널은 운영체제의 핵심 부분으로, 하드웨어와 소프트웨어 간의 인터페이스 역할을 한다.
- ✔ Docker 컨테이너는 호스트 OS의 커널을 공유하며, 프로세스, 메모리, 네트워크 등을 격리하여 독립적인 실행 환경을 제공한다.
- ✔ Docker 컨테이너는 전통적인 VM처럼 독립적인 OS를 가지지 않으며, 반드시 호스트 커널이 필요하다.
- ✔ Docker는 Namespaces(네임스페이스)와 cgroups(Control Groups)를 활용하여 컨테이너 단위의 격리를 제공한다.
- ✔ Windows에서 Linux 컨테이너를 실행하려면, Hyper-V 또는 WSL2를 통해 리눅스 커널을 실행해야 한다.

## Docker 의 필요성과 기대 효과
- 환경 일관성: 개발, 테스트, 운영 환경에서 동일한 실행 환경을 유지 가능
- 빠른 배포: 컨테이너를 빠르게 시작하고 중단할 수 있음
- 리소스 효율성: 가상 머신보다 적은 리소스를 사용하며, OS 커널을 공유하여 오버헤드를 줄일 수 있음.
- 이식성: 컨테이너 이미지 기반으로 패키징되어, 다양한 OS 및 클라우드 환경에서 동일한 애플리케이션을 실행할 수 있음.

* 오버헤드 : 어떤 작업을 수행하는 데 직접적인 결과를 내는 것이 아니라, 부가적으로 발생하는 연산 비용이나 리소스 소비

## Docker Image 란?
Docker Image 는 컨테이너 실행에 필요한 모든 요소(코드, 라이브러리, 설정 파일 등)를 포함하는 불변(immutable)한 템플릿이다. 컨테이너는 이 이미지를 기반으로 만들어진다.

## Docker Container 란?
Docker Container 는 이미지 기반으로 실행될 수 있는 독립된 프로세스이다. 컨테이너는 격리된 환경에서 실행되며, 필요할 때마다 생성하고 삭제할 수 있다.

* 프로세스란, 컴퓨터에서 실행 중인 프로그램을 의미한다. 즉, 프로그램(코드) 는 단순한 파일이지만, 이것이 실행되면 운영체제가 관리하는 독립적인 실행 단위인 프로세스가 된다.

컨테이너를 프로그램이라고 보는 것 보다는 프로그램을 실행할 수 있는 격리된 환경을 제공하는 역할을 한다고 표현하는 것이 좀 더 올바르다. 비록 컨테이너가 코드(프로그램)와 실행 환경(라이브러리, 종속성, 설정 등)을 포함하고 있지만, 운영체제 입장에서 보면 컨테이너 자체는 독립적인 프로세스로 실행된다.

## Windows 컴퓨터에서 어떻게 Ubuntu 기반의 컨테이너가 작동할 수 있을까?
Windows 운영체제는 Windows 커널을 사용하기 때문에, 근본적으로 Ubuntu 커널에 대한 접근이 불가능하다. 이를 극복하기 위해 가상화 계층을 도입할 수 있다.

첫째로, WSL2 를 사용하는 방법이다. WSL2 는 Windows 에서 리눅스 커널을 실행할 수 있도록 하는 가벼운 가상화 기술로, 실제로 MS 가 만든 커스텀 Linux 커널을 포함하고 있으며, 이를 통해 리눅스 컨테이너를 실행할 수 있다. Docker Desktop 에서 WSL2 기반 엔진을 선택하면 리눅스 커널을 사용하는 컨테이너를 실행할 수 있다.

두 번째로, Hyper-V 기반 실행이다. Windows 에는 Hyper-V 라는 가상화 기술이 포함되어 있으며, 이를 통해 리눅스 가상 머신을 실행한 후 리눅스 컨테이너를 실행할 수 있다. 윈도우에서 리눅스 컨테이너를 실행하려면 리눅스 커널이 필요하니까 Hyper-V 를 이용해 리눅스 환경을 가상으로 제공하는 것이다.

Docker 는 내부적으로 가벼운 LinuxKit 가상 머신을 실행하여 리눅스 컨테이너를 동작시킨다. WSL2 보다는 성능이 조금 낮을 수 있지만, 안정적인 실행이 가능하며 WSL2 와 같은 별도의 프로그램의 설치 없이 Docker Desktop 설정만으로 간단하게 실행이 가능하다.

결론적으로, 윈도우에서 리눅스 OS 의 커널을 실행할 수 있는 방식은 총 세 가지인 것이다.
- Hyper-V 기반 실행 → Windows의 기본 가상화 기능을 활용하여 리눅스 컨테이너 실행
- LinuxKit 기반 실행 → 가벼운 리눅스 VM을 Docker 내부에서 자체적으로 실행
- WSL2 기반 실행 → Windows의 최신 리눅스 서브시스템을 활용하여 성능 최적화

## Docker Compose 파일이란?
Docker Compose는 여러 개의 컨테이너를 정의하고 실행할 수 있도록 해주는 도구이다. docker-compose.yml 파일을 사용하여 애플리케이션의 여러 서비스(예: 웹 서버, 데이터베이스 등)를 선언적으로 정의할 수 있다.

## Docker Compose 파일에 들어갈 수 있는 옵션은?
- version: Docker Compose 파일의 버전 지정
- services: 실행할 컨테이너 정의
- volumes: 컨테이너와 호스트 간의 데이터 공유 설정
- networks: 컨테이너 간 네트워크 설정
- environment: 환경 변수 지정
- build: Dockerfile을 기반으로 이미지 빌드
- ports: 호스트와 컨테이너 간 포트 매핑

## Shell Script 로 대체할 수는 없는 걸까?
단일 컨테이너 실행이라면 Shell Script로 docker run 을 실행하는 것도 가능하지만, 여러 컨테이너를 조합해야 한다면 docker-compose.yml을 사용하는 것이 훨씬 효율적이다.

## 데이터베이스 서버를 도커로 가상화 해야 할까?
- 로컬 개발환경: 도커를 사용하는 것이 좋음 (환경 일관성 유지, 간편한 설정)
- 운영 환경: 대규모 트래픽이 필요한 경우, 도커보다 직접 데이터베이스를 설치하는 것이 더 안정적일 수 있음

## File I/O 로 이미지 혹은 동영상을 제공한다면, Docker 로 패키징하는 것이 의미가 있을까?
이미지나 동영상을 저장하고 제공하는 것 자체는 컨테이너화의 필요성이 낮다. 하지만 API 서버를 통해 제공하는 경우, 컨테이너를 이용하면 배포가 쉬워지고 확장성이 좋아진다.

## 이미지 혹은 동영상을 File I/O 로 제공하는 것보다, 서버로 띄우는 게 더 좋을까
- File I/O (로컬 파일 저장): 소규모 프로젝트나 간단한 스토리지 용도로 적합
- 서버를 띄워서 제공 (CDN, 클라우드 스토리지): 대규모 트래픽 처리 시 성능과 확장성이 뛰어남

## 볼륨화란?
Docker 볼륨(Volume)은 컨테이너의 데이터를 호스트에 저장하는 방식이다. 컨테이너가 삭제되더라도 데이터를 유지할 수 있도록 하며, 데이터베이스 같은 상태가 필요한 서비스에 필수적이다.