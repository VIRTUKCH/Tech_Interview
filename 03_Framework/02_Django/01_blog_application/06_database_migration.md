# Database Migration

장고 애플리케이션에는 대용량 데이터를 위한 데이터베이스가 필요하다. settings.py 파일에는 프로젝트를 위한 데이터베이스 구성이 DATABASES 설정에 포함되어 있다.

기본 구성은 SQLite3 데이터베이스이다. SQLite 는 파이썬 3과 함께 번들로 제공되며, 장고로 개발할 때 함께 사용할 수 있는 경량 데이터베이스이다.

프로덕션 환경에 애플리케이션을 배포하고자 한다면 PostgreSQL, MySQL, Oracle 과 같이 많은 기능을 제공하는 DBMS 를 사용하는 것이 옳겠다.

## 1. 명령어
```bash
cd {project_directory}
python manage.py migrate
```

이 명령어는 Django 프로젝트에서 데이터베이스 스키마를 업데이트하는 작업을 수행한다고 한다.

이 명령어를 수행하면 
- 모델 변경 사항을 데이터베이스에 적용하고
- 아직 적용되지 않은 모든 마이그레이션을 실행하며
- 테이블 생성, 필드 추가/수정/삭제, 인덱스 생성 등의 데이터베이스 구조 변경 작업을 수행한다.

## 2. Migration (마이그레이션)
Django 의 마이그레이션은 모델 변경 사항(필드 추가/삭제, 테이블 변경 등)을 데이터베이스에 반영하는 방법이다. Django 는 모델 변경 사항을 추적하고 이를 기반으로 마이그레이션 파일을 생성하여 데이터베이스 스키마를 업데이트한다.

Migration 이라는 단어는 보통 '이동' 이나 '변화' 라는 의미를 가지고 있다고 한다. 모델의 구조가 변경될 때, 이러한 변경 사항을 데이터베이스에 반영하기 위해 일종의 '이동' 작업을 수행한다.

다시 말해서, 애플리케이션의 데이터 모델이 변경될 때마다, 그에 맞춰 데이터베이스의 스키마를 변경하는 과정을 나타내기 위해 이 용어가 사용된다고 한다.

## 3. models.py
Model 이란, Django 에서 데이터베이스의 구조를 정의하는 클래스라고 한다. 각 모델 클래스는 데이터베이스의 테이블에 해당하며, 모델의 필드는 테이블의 컬럼을 나타낸다.

Spring JPA 에서는 @Entity 라는 애너테이션을 이용해 엔티티를 정의할 수 있었고, ddl-auto 옵션을 create 로 두면 제약 조건이나 컬럼의 수정 같은 것들이 가능했다.

Django 는 이러한 기능을 모델 클래스와 마이그레이션 시스템을 통해 제공한다. 즉, 모델을 정의하고 변경한 후에는 makemigrations 명령어로 마이그레이션 파일을 생성하고, migrate 명령어로 이를 데이터베이스에 적용하여 구조를 업데이트 할 수 있다.

Django에서도 모델 클래스를 여러 파일로 분리하여 관리할 수 있다. 각 모델을 별도의 파일로 나누면 코드의 가독성과 유지보수성을 높일 수 있다. 이를 위해 models라는 디렉토리를 만들고, 각 모델을 별도의 파일로 정의할 수 있다.

```
myapp/
    models/
        __init__.py
        author.py
        book.py
```
이런 느낌이다.

## 4. Schema (스키마)
스키마는 데이터베이스의 구조를 정의하는 것이다. 데이터베이스 내에서 데이터가 어떻게 조직되고 저장되는지를 설명하는 청사진 역할을 한다.

[스키마의 구성 요소]
- 테이블: 데이터베이스의 기본 단위로, 특정 주제나 개체에 대한 정보를 저장하는 구조.
- 필드(컬럼): 각 테이블 내의 데이터 항목을 정의하며, 데이터 타입과 제약 조건을 포함.
- 데이터 타입: 각 필드에 저장될 수 있는 데이터의 종류를 정의 (예: 문자열, 정수, 날짜 등).
- 인덱스: 데이터 검색 성능을 향상시키기 위해 사용되는 데이터 구조.
- 제약 조건: 데이터의 무결성을 유지하기 위해 설정되는 규칙 (예: 고유성, 외래 키 제약 조건 등).
- 관계: 테이블 간의 관계를 정의하며, 예를 들어 외래 키를 통해 두 테이블의 연관성을 나타냄.

스키마라 하면 위와 같은 구성 요소를 포함한 구조를 이야기한다.

## 5. Django 의 마이그레이션의 특징
Django 의 마이그레이션은 데이터베이스 스키마 변경 뿐만 아니라 데이터 조작도 가능하다. 마이그레이션 파일 내에서 데이터베이스의 초기 데이터 삽입, 데이터 변환 및 데이터 삭제와 같은 작업을 정의할 수 있다.

예를 들어, 새로운 필드를 추가하거나 기존 필드의 값을 변경하는 등의 작업을 마이그레이션 파일에 포함시킬 수 있다.

Java 의 경우에는 초기 데이터 삽입을 위해 DataLoader 와 같은 별도의 클래스를 사용해야 하지만, Django 는 자체적으로 그러한 기능을 지원하는 것으로 보인다.