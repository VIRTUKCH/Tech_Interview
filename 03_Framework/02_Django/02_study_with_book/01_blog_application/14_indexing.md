# Indexing

## 1. 인덱싱이란?
인덱싱은 데이터베이스에서 데이터 검색 성능을 향상시키기 위해 사용되는 기술이다. 책의 목차처럼 작용하여, 특정 데이터를 빠르게 찾을 수 있도록 도와준다.

인덱스는 데이터베이스 테이블의 특정 열에 대한 값과 해당 값이 저장된 위치를 매핑하여, 검색 쿼리의 성능을 크게 개선한다.

### 인덱스의 장점
- 검색 속도 향상 : 대량의 데이터를 빠르게 검색할 수 있다.
- 정렬 및 필터링 : 데이터 정렬과 필터링 작업을 효율적으로 처리할 수 있다.

### 인덱스의 단점
- 추가적인 저장 공간 : 인덱스는 추가적인 저장 공간을 필요로 한다.
- 쓰기 성능 저하 : 데이터의 삽입, 수정, 삭제 시에 인덱스를 업데이트해야 하므로, 쓰기 작업의 성능이 저하될 수 있다.

## 2. DBMS 가 데이터를 저장하는 구조
DBMS(Database Management System)는 데이터를 효율적으로 저장하고 관리하기 위해 다양한 구조를 사용한다. 일반적으로 데이터는 테이블 형태로 저장되며, 각 테이블은 여러 열과 행으로 구성된다.

### 2-1. 데이터 저장 구조
- 테이블 : 데이터는 행(row)과 열(column)로 구성된 테이블에 저장된다.
- 페이지 : 데이터는 페이지 단위로 저장되며, 페이지는 디스크에서 읽고 쓰는 기본 단위이다.
- 블록 : 여러 페이지가 모여 블록을 형성한다. DBMS 는 블록 단위로 데이터를 디스크에 저장하고 관리한다.
- 인덱스 : 인덱스는 별도의 데이터 구조로, 특정 열의 값과 해당 데이터의 위치를 매핑하여 검색 성능을 향상시킨다. 인덱스는 B-tree, 해시, GiST, GIN 등 다양한 형태로 구현될 수 있다.

#### 2-1-1. 페이지
페이지는 디스크 I/O 작업에서 효율성을 높이기 위해 데이터베이스가 사용하는 기본 저장 단위이다. 일반적으로 4KB 또는 8KB 크기로 설정되며, 데이터가 페이지 단위로 읽고 쓰여진다.

데이터베이스는 페이지 단위로 데이터를 읽고 쓰기 때문에, 페이지의 크기에 맞추어 쿼리를 작성하면 I/O 효율성을 높일 수 있는 경우가 있다. 예를 들어, 여러 개의 작은 레코드를 하나의 페이지에 포함시켜 한 번에 읽을 수 있다면, 디스크 I/O 를 줄일 수 있다.

#### 2-1-2. 블록
블록은 여러 페이지를 모아 구성되며, DBMS 가 데이터베이스의 물리적 저장을 관리하는 데 사용된다. 블록은 데이터의 읽기 및 쓰기 작업을 최적화하기 위해 사용된다.

## 3. 인덱싱에 대해 알아야 할 것들
테이블을 생성할 때 특정 자료 구조(ex_ B-Tree, Red-Black Tree 등)를 직접 선택할 수는 없다. 그러나, 많은 DBMS 가 기본적으로 B-Tree 구조를 사용하여 인덱스를 관리하고, 이 인덱스는 특정 데이터 타입과 쿼리에 따라 자동으로 생성된다.

### 3-1. 인덱스의 유형

#### 3-1-1. B-Tree 인덱스
기본적으로 사용되는 인덱스 유형으로, 범위 검색과 정렬에 적합하다.

##### Q. B-Tree 인덱스가 데이터를 저장하는 방법
B-Tree 인덱스는 각 노드가 여러 개의 키와 자식 포인터를 가지고 있는 구조이다. 이 구조는 균형을 유지하며, 각 노드는 정렬된 순서로 키를 저장하여 검색 효율성을 높인다. 키를 비교하면서 자식 노드를 따라가며 원하는 값을 찾는다.

B-Tree 는 각 노드가 여러 개의 자식을 가질 수 있기 때문에, 데이터가 많아도 트리의 높이를 낮게 유지하여 검색 성능을 최적화할 수 있다.

##### Q. B-Tree 자료 구조에 삽입, 조회, 수정, 삭제에 따른 시간 복잡도
- 삽입: O(log n) : 적절한 위치를 찾기 위해 트리를 탐색하고, 필요한 경우 노드를 분할하여 균형을 유지한다.
- 조회: O(log n) : 루트부터 시작하여 적절한 자식 노드를 따라가며 탐색한다.
- 수정: O(log n) : 해당 키를 삭제한 후 새로운 값을 삽입한다.
- 삭제: O(log n) : 해당 키를 찾아서 삭제하고, 균형을 유지하기 위해 필요한 경우 노드를 병합 or 재구성한다.
- 병합 및 재구성 O(log n) : 트리의 깊이에 따라 시간이 소요된다.

##### Q. B-Tree 의 장단점

###### 장점
- B-Tree 는 균형을 유지하기 때문에, 검색 성능이 뛰어나며 O(log n) 시간 복잡도를 보장한다.
- 키가 정렬된 상태로 저장되기 때문에 범위 검색과 정렬 작업에 유리하다.
- B-Tree 는 디스크 블록 크기를 고려하여 설계되어, 최소한의 디스크 접근으로 데이터를 검색할 수 있다.
- 노드 분할 및 병합을 통해 삽입과 삭제가 효율적이다.

###### 단점
- B-Tree 는 포인터와 키를 저장해야 하므로, 추가적인 저장 공간이 필요하다.
- 삽입, 삭제 시 균형을 유지하기 위한 작업이 필요하므로, 쓰기 작업의 성능이 저하될 수 있다.
- B-Tree 의 균형을 유지하기 위한 알고리즘이 복잡하여 구현이 상대적으로 어렵다.

#### 3-1-2. Hash 인덱스
정확한 일치 검색에 유리하지만, 범위 검색에는 적합하지 않다.

##### Q. Hash 인덱스가 범위 검색에 적절하지 않은 이유
해시 인덱스는 해시 함수를 사용하여 키를 해시 값으로 변환하고, 이 해시 값을 기반으로 데이터를 저장한다.

이 구조는 특정 키에 대한 빠른 검색을 가능하게 하지만, 해시 함수는 입력 값의 순서와 관계 없이 고유한 해시 값을 생성하기 때문에, 해시 키 인덱스는 키의 순서 정보를 유지하지 않는다.

따라서, 해시 인덱스는 범위 검색(ex_ "BETWEEN", ">", "<")을 지원하지 않으며, 특정 범위 내에 값을 찾는 것이 불가능하다.

##### Q. Hash 인덱스 자료 구조에 삽입, 조회, 수정, 삭제에 따른 시간 복잡도
- 삽입: O(log n)
- 조회: O(log n)
- 수정: O(log n)
- 삭제: O(log n)

##### Q. Hash 인덱스의 장단점

###### 장점
- 검색 속도가 매우 빠르다

###### 단점
- 범위 검색이 불가하다
- 서로 다른 키가 동일한 해시 값을 가질 수 있는 해시 충돌이 발생할 수 있으며, 이를 처리하기 위한 추가 작업이 필요하다. 해시 충돌이 많아질 경우 성능 저하가 발생할 수 있다.
- 해시 테이블은 충돌을 피하기 위해 추가적인 메모리를 사용할 수 있으며, 적절한 해시 함수와 크기를 선택하지 않으면 비효율적으로 메모리를 사용할 수 있다.

##### Q. Member Table 이 프로그램에서 빈번하게 접근된다면, 해시 인덱스를 걸면 어떨까?
좋은 선택이 될 수 있으나, 범위 검색이 필요한 경우나 해시 충돌이 우려되는 경우에는 B-Tree 인덱스와 같은 다른 인덱스 유형을 고려하는 것이 좋다.

#### 3-1-3. GIN (Generalized Inverted Index)
배열이나 JSONB 데이터와 같은 다수의 값을 가진 필드에 적합하다.

#### 3-1-4. GiST (Generalized Search Tree)
공간 데이터 및 복합 데이터 타입에 유리한 인덱스이다.

#### 3-1-5. BRIN (Block Range INdex)
큰 테이블에서 효율적으로 사용할 수 있는 인덱스이다.

##### Q. BRIN 의 데이터 저장 방법
BRIN 인덱스는 데이터 블록의 메타데이터 정보를 저장하여, 각 블록의 최소 및 최대 값을 기록한다.

데이터베이스 테이블을 여러 블록(페이지)으로 나누고, 각 블록에 대해 최소값과 최대값을 기록한다. 예를 들어, 데이터가 정렬된 경우, 첫 번째 블록의 최소값과 최대값, 두 번째 블록의 최소값과 최대값을 저장한다.

각 블록의 메타데이터는 해당 블록에 포함된 데이터의 범위를 나타내며, 이 정보는 인덱스 테이블에 저장된다. 이를 통해 검색 시, 전체 데이터를 스캔하지 않고도 해당 블록에 데이터가 존재하는지 판단할 수 있다.

또한, BRIN 인덱스는 대량의 데이터에 대해 필요한 블록만을 읽어들이도록 설계되어, 디스크 I/O 를 최소화한다.

##### Q. BRIN 인덱스 자료 구조에 삽입, 조회, 수정, 삭제에 따른 시간 복잡도
- 삽입: O(1)
- 조회: O(log n)
- 수정: O(1)
- 삭제: O(1)

##### Q. BRIN 인덱스의 장단점

###### 장점
- 저장 공간 효율성: BRIN 인덱스는 블록 범위 정보를 저장하므로, 대량의 데이터를 효율적으로 처리할 수 있고, 저장 공간을 절약할 수 있습니다.
- 빠른 검색: 데이터가 정렬된 경우, BRIN 인덱스는 필요한 블록만을 읽어들이기 때문에 검색 성능이 향상됩니다.
- 대용량 데이터에 적합: 큰 테이블에서 특히 유용하며, 전체 데이터를 스캔하는 대신 블록 레인지 정보를 활용하여 성능을 개선할 수 있습니다.

###### 단점
- 정확한 검색 성능 저하: BRIN 인덱스는 블록 범위 정보를 기반으로 하므로, 정확한 키를 찾기 위해 실제 데이터 블록을 스캔해야 할 수 있습니다. 이는 성능 저하를 초래할 수 있습니다.
- 비정렬 데이터에 대한 비효율성: 데이터가 비정렬되어 있을 경우, BRIN 인덱스의 효율성이 떨어질 수 있습니다.
- 작성 및 유지 관리의 복잡성: BRIN 인덱스는 블록 정보를 관리해야 하므로, 작성 및 유지 관리가 복잡할 수 있습니다.